<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم صدور فاکتور پیشرفته</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cg id='SVGRepo_bgCarrier' stroke-width='0'%3E%3C/g%3E%3Cg id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'%3E%3C/g%3E%3Cg id='SVGRepo_iconCarrier'%3E %3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M6.55281 1.60553C7.10941 1.32725 7.77344 1 9 1C10.2265 1 10.8906 1.32722 11.4472 1.6055L11.4631 1.61347C11.8987 1.83131 12.2359 1.99991 13 1.99993C14.2371 1.99998 14.9698 1.53871 15.2141 1.35512C15.5944 1.06932 16.0437 1.09342 16.3539 1.2369C16.6681 1.38223 17 1.72899 17 2.24148L17 13H20C21.6562 13 23 14.3415 23 15.999V19C23 19.925 22.7659 20.6852 22.3633 21.2891C21.9649 21.8867 21.4408 22.2726 20.9472 22.5194C20.4575 22.7643 19.9799 22.8817 19.6331 22.9395C19.4249 22.9742 19.2116 23.0004 19 23H5C4.07502 23 3.3148 22.7659 2.71092 22.3633C2.11331 21.9649 1.72739 21.4408 1.48057 20.9472C1.23572 20.4575 1.11827 19.9799 1.06048 19.6332C1.03119 19.4574 1.01616 19.3088 1.0084 19.2002C1.00194 19.1097 1.00003 19.0561 1 19V2.24146C1 1.72899 1.33184 1.38223 1.64606 1.2369C1.95628 1.09341 2.40561 1.06931 2.78589 1.35509C3.03019 1.53868 3.76289 1.99993 5 1.99993C5.76415 1.99993 6.10128 1.83134 6.53688 1.6135L6.55281 1.60553ZM3.00332 19L3 3.68371C3.54018 3.86577 4.20732 3.99993 5 3.99993C6.22656 3.99993 6.89059 3.67269 7.44719 3.39441L7.46312 3.38644C7.89872 3.1686 8.23585 3 9 3C9.76417 3 10.1013 3.16859 10.5369 3.38643L10.5528 3.39439C11.1094 3.67266 11.7734 3.9999 13 3.99993C13.7927 3.99996 14.4598 3.86581 15 3.68373V19C15 19.783 15.1678 20.448 15.4635 21H5C4.42498 21 4.0602 20.8591 3.82033 20.6992C3.57419 20.5351 3.39761 20.3092 3.26943 20.0528C3.13928 19.7925 3.06923 19.5201 3.03327 19.3044C3.01637 19.2029 3.00612 19.1024 3.00332 19ZM19.3044 20.9667C19.5201 20.9308 19.7925 20.8607 20.0528 20.7306C20.3092 20.6024 20.5351 20.4258 20.6992 20.1797C20.8591 19.9398 21 19.575 21 19V15.999C21 15.4474 20.5529 15 20 15H17L17 19C17 19.575 17.1409 19.9398 17.3008 20.1797C17.4649 20.4258 17.6908 20.6024 17.9472 20.7306C18.2075 20.8607 18.4799 20.9308 18.6957 20.9667C18.8012 20.9843 18.8869 20.9927 18.9423 20.9967C19.0629 21.0053 19.1857 20.9865 19.3044 20.9667Z' fill='%230F0F0F'%3E%3C/path%3E %3Cpath d='M5 8C5 7.44772 5.44772 7 6 7H12C12.5523 7 13 7.44772 13 8C13 8.55229 12.5523 9 12 9H6C5.44772 9 5 8.55229 5 8Z' fill='%230F0F0F'%3E%3C/path%3E %3Cpath d='M5 12C5 11.4477 5.44772 11 6 11H12C12.5523 11 12.5523 11 12.5523 11C12.5523 11.4477 13 11.4477 13 12C13 12.5523 12.5523 13 12 13H6C5.44772 13 5 12.5523 5 12Z' fill='%230F0F0F'%3E%3C/path%3E %3Cpath d='M5 16C5 15.4477 5.44772 15 6 15H12C12.5523 15 13 15.4477 13 16C13 16.5523 12.5523 17 12 17H6C5.44772 17 5 16.5523 5 16Z' fill='%230F0F0F'%3E%3C/path%3E %3C/g%3E%3C/svg%3E">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Persian Date - استفاده از لینک‌های جایگزین -->
    <script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/persian-datepicker.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/persian-datepicker.min.css">
    
    <!-- سایر کتابخانه‌ها -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="./styles.css">
    
    <style>
        /* اضافه کردن استایل برای تاریخ‌شمار در صورت عدم بارگذاری */
        .pwt-btn-today, .pwt-btn-clear {
            display: none;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-gray-100">
    <!-- صفحه ورود -->
    <div id="loginPage" class="login-container p-8 w-full max-w-md">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">سیستم صدور فاکتور پیشرفته</h1>
            <p class="text-gray-600">لطفا برای ورود به سیستم اطلاعات خود را وارد کنید</p>
        </div>
        <div class="mb-6">
            <label class="block text-gray-700 mb-2 font-medium">نام کاربری</label>
            <input id="username" type="text" placeholder="نام کاربری" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
        </div>
        <div class="mb-6">
            <label class="block text-gray-700 mb-2 font-medium">رمز عبور</label>
            <input id="password" type="password" placeholder="رمز عبور" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
        </div>
        <button onclick="login()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:-translate-y-1 shadow-md">
            ورود به سیستم
        </button>
        <p id="loginError" class="text-red-500 text-center mt-4 hidden">نام کاربری یا رمز عبور اشتباه است.</p>
        <div class="mt-4 text-center text-sm text-gray-600">
            <p>نام کاربری پیش‌فرض: admin | رمز عبور: admin</p>
            <p>نام کاربری پیش‌فرض: user | رمز عبور: user</p>
        </div>
        <div class="mt-4 text-center">
            <button onclick="showPasswordRecovery()" class="text-blue-600 hover:text-blue-800 text-sm">
                بازیابی رمز عبور
            </button>
        </div>
    </div>

    <!-- صفحه اصلی فاکتور -->
    <div id="mainPage" class="main-container p-4 sm:p-8 w-full max-w-7xl hidden">
        <div class="flex flex-col sm:flex-row justify-between items-center mb-8">
            <div>
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">سیستم صدور فاکتور پیشرفته</h1>
                <p class="text-gray-600 mt-1">مدیریت فروش، خریداران و انبار</p>
                <p id="userInfo" class="text-sm text-blue-600 mt-1"></p>
            </div>
            <div class="flex flex-wrap gap-2 mt-4 sm:mt-0">
                <button onclick="showUserProfile()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition">
                    <i class="fas fa-user mr-2"></i> پروفایل
                </button>
                <button onclick="exportData()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition">
                    <i class="fas fa-download mr-2"></i> ذخیره داده‌ها
                </button>
                <button onclick="importData()" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg transition">
                    <i class="fas fa-upload mr-2"></i> بازیابی داده‌ها
                </button>
                <button onclick="syncWithIndexedDB()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition">
                    <i class="fas fa-sync mr-2"></i> همگام‌سازی
                </button>
                <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition">
                    خروج از سیستم
                </button>
            </div>
        </div>
        <input type="file" id="importFile" accept=".json" style="display: none" onchange="handleFileSelect(event)">

        <!-- تب‌ها -->
        <div class="flex flex-wrap border-b mb-6">
            <button class="tab-button active" onclick="openTab('sellerTab')">
                <i class="fas fa-store-alt mr-2"></i> مدیریت فروشنده
            </button>
            <button class="tab-button" onclick="openTab('customerTab')">
                <i class="fas fa-users mr-2"></i> مدیریت خریدار
            </button>
            <button class="tab-button" onclick="openTab('inventoryTab')">
                <i class="fas fa-boxes mr-2"></i> مدیریت انبار
            </button>
            <button class="tab-button" onclick="openTab('invoiceTab')">
                <i class="fas fa-file-invoice-dollar mr-2"></i> صدور فاکتور
            </button>
            <button class="tab-button" onclick="openTab('invoiceManagementTab')">
                <i class="fas fa-list-alt mr-2"></i> مدیریت فاکتورها
            </button>
            <button class="tab-button" onclick="openTab('accountingTab')">
                <i class="fas fa-chart-line mr-2"></i> مدیریت حسابداری
            </button>
            <button class="tab-button" onclick="openTab('reportsTab')">
                <i class="fas fa-chart-bar mr-2"></i> گزارش‌ها و آمار
            </button>
            <button id="userManagementTabButton" class="tab-button hidden" onclick="openTab('userManagementTab')">
                <i class="fas fa-users-cog mr-2"></i> مدیریت کاربران
            </button>
        </div>

        <!-- محتوای تب‌ها -->
        
        <!-- تب مدیریت فروشنده -->
        <div id="sellerTab" class="tab-content active">
            <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-store-alt ml-2 text-blue-600"></i> مدیریت فروشنده
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">نام فروشنده</label>
                    <input id="sellerNameInput" type="text" placeholder="نام فروشنده" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">شماره تماس فروشنده</label>
                    <input id="sellerPhoneInput" type="text" placeholder="شماره تماس فروشنده" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">کد ملی فروشنده</label>
                    <input id="sellerNationalIdInput" type="text" placeholder="کد ملی فروشنده" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">کد اقتصادی فروشنده</label>
                    <input id="sellerEconomicCodeInput" type="text" placeholder="کد اقتصادی فروشنده" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">کد پستی فروشنده</label>
                    <input id="sellerPostalCodeInput" type="text" placeholder="کد پستی فروشنده" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">شماره حساب فروشنده</label>
                    <input id="sellerAccountNumberInput" type="text" placeholder="شماره حساب فروشنده" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div class="sm:col-span-2">
                    <label class="block text-gray-700 mb-2 font-medium">آدرس فروشنده</label>
                    <input id="sellerAddressInput" type="text" placeholder="آدرس فروشنده" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">بارگذاری لوگو شرکت</label>
                    <input id="sellerLogoInput" type="file" accept="image/*" class="w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">بارگذاری امضا فروشنده</label>
                    <input id="sellerSignatureInput" type="file" accept="image/*" class="w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div class="sm:col-span-2 flex flex-col sm:flex-row justify-between gap-4">
                    <button onclick="addSeller()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:-translate-y-1 shadow-md">
                        افزودن/ویرایش فروشنده
                    </button>
                    <select id="sellerSelect" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                        <option value="">انتخاب فروشنده</option>
                    </select>
                </div>
            </div>
            <div id="sellerList" class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
        </div>

        <!-- تب مدیریت خریدار -->
        <div id="customerTab" class="tab-content">
            <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-users ml-2 text-blue-600"></i> مدیریت خریدار
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">نام مشتری</label>
                    <input id="customerNameInput" type="text" placeholder="نام مشتری" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">شماره تماس</label>
                    <input id="customerPhoneInput" type="text" placeholder="شماره تماس" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">کد ملی مشتری</label>
                    <input id="customerNationalIdInput" type="text" placeholder="کد ملی مشتری" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">کد اقتصادی مشتری</label>
                    <input id="customerEconomicCodeInput" type="text" placeholder="کد اقتصادی مشتری" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">کد پستی مشتری</label>
                    <input id="customerPostalCodeInput" type="text" placeholder="کد پستی مشتری" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">شماره حساب مشتری</label>
                    <input id="customerAccountNumberInput" type="text" placeholder="شماره حساب مشتری" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div class="sm:col-span-2">
                    <label class="block text-gray-700 mb-2 font-medium">آدرس مشتری</label>
                    <input id="customerAddressInput" type="text" placeholder="آدرس مشتری" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div class="sm:col-span-2 flex flex-col sm:flex-row justify-between gap-4">
                    <button onclick="addCustomer()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:-translate-y-1 shadow-md">
                        افزودن/ویرایش خریدار
                    </button>
                    <select id="customerSelect" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                        <option value="">انتخاب خریدار</option>
                    </select>
                </div>
            </div>
            <div id="customerList" class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
        </div>

        <!-- تب مدیریت انبار -->
        <div id="inventoryTab" class="tab-content">
            <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-boxes ml-2 text-blue-600"></i> مدیریت انبار
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">کد محصول</label>
                    <input id="productCodeInput" type="text" placeholder="کد محصول" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">نام محصول</label>
                    <input id="productNameInput" type="text" placeholder="نام محصول" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">موجودی</label>
                    <div class="flex items-center gap-4">
                        <input id="productStockInput" type="number" placeholder="موجودی" min="0" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                        <label class="flex items-center">
                            <input id="unlimitedStock" type="checkbox" class="mr-2 w-5 h-5">
                            <span class="text-gray-700">نامحدود</span>
                        </label>
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">قیمت واحد</label>
                    <input id="productPriceInput" type="number" placeholder="قیمت واحد" min="0" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">بارگذاری تصویر محصول</label>
                    <input id="productImageInput" type="file" accept="image/*" class="w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div class="sm:col-span-2">
                    <button onclick="addProduct()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:-translate-y-1 shadow-md">
                        افزودن/ویرایش محصول
                    </button>
                </div>
            </div>
            <div id="productList" class="mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>

        <!-- تب صدور فاکتور -->
        <div id="invoiceTab" class="tab-content">
            <!-- فرم اطلاعات فاکتور -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-file-invoice-dollar ml-2 text-blue-600"></i> اطلاعات فاکتور
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">تاریخ شمسی</label>
                        <input id="invoiceDate" type="text" placeholder="مثال: ۱۴۰۴/۰۵/۱۶" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">شماره فاکتور</label>
                        <input id="invoiceNumber" type="text" placeholder="شماره فاکتور" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">نوع فاکتور</label>
                        <select id="invoiceType" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                            <option value="صورتحساب فروش">صورتحساب فروش</option>
                            <option value="صورتحساب خرید">صورتحساب خرید</option>
                            <option value="پیش‌فاکتور">پیش‌فاکتور</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">عنوان فاکتور (در صورت عدم انتخاب فروشنده)</label>
                        <input id="invoiceTitle" type="text" placeholder="عنوان فاکتور" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">انتخاب فروشنده</label>
                        <select id="sellerSelectInvoice" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                            <option value="">انتخاب فروشنده</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">جستجوی خریدار</label>
                        <div class="dropdown">
                            <input id="customerSearch" type="text" placeholder="جستجوی خریدار (نام یا کد ملی)" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                            <div id="customerSearchDropdown" class="dropdown-content"></div>
                            <input id="customerIndex" type="hidden">
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">مانده از قبل</label>
                        <input id="previousDebt" type="number" placeholder="مانده از قبل" min="0" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition" oninput="updateTable()">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">واحد پول</label>
                        <select id="currency" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition" onchange="updateTable()">
                            <option value="rial">ریال</option>
                            <option value="toman">تومان</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- فرم آیتم‌های فاکتور -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-shopping-cart ml-2 text-blue-600"></i> آیتم‌های فاکتور
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-5 gap-4 mb-6">
                    <div class="sm:col-span-1">
                        <label class="block text-gray-700 mb-2 font-medium">جستجوی محصول</label>
                        <div class="dropdown">
                            <input id="itemSearch" type="text" placeholder="جستجوی محصول (کد یا نام)" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                            <div id="itemSearchDropdown" class="dropdown-content"></div>
                            <input id="itemCode" type="hidden">
                        </div>
                    </div>
                    <div class="sm:col-span-1">
                        <label class="block text-gray-700 mb-2 font-medium">شرح</label>
                        <input id="itemName" type="text" placeholder="شرح" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div class="sm:col-span-1">
                        <label class="block text-gray-700 mb-2 font-medium">تعداد</label>
                        <input id="itemQty" type="number" placeholder="تعداد" min="1" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div class="sm:col-span-1">
                        <label class="block text-gray-700 mb-2 font-medium">قیمت واحد</label>
                        <input id="itemPrice" type="number" placeholder="قیمت واحد" min="0" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div class="sm:col-span-1 flex items-end">
                        <button onclick="addItem()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:-translate-y-1 shadow-md">
                            افزودن آیتم
                        </button>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-6">
                    <div id="itemImagePreview" class="hidden sm:w-1/4"></div>
                    <div class="w-full overflow-x-auto">
                        <table class="w-full text-right border-collapse text-sm sm:text-base">
                            <thead>
                                <tr class="bg-gray-200">
                                    <th class="p-2 sm:p-3 border">ردیف</th>
                                    <th class="p-2 sm:p-3 border">تصویر</th>
                                    <th class="p-2 sm:p-3 border">کد محصول</th>
                                    <th class="p-2 sm:p-3 border">شرح</th>
                                    <th class="p-2 sm:p-3 border">تعداد</th>
                                    <th class="p-2 sm:p-3 border">قیمت واحد</th>
                                    <th class="p-2 sm:p-3 border">مجموع</th>
                                    <th class="p-2 sm:p-3 border">ویرایش</th>
                                    <th class="p-2 sm:p-3 border">حذف</th>
                                </tr>
                            </thead>
                            <tbody id="itemTable" class="bg-white"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- فرم مالیات، تخفیف و مقادیر دلخواه -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-calculator ml-2 text-blue-600"></i> جزئیات مالی
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">نرخ مالیات (%)</label>
                        <input id="taxRate" type="number" placeholder="نرخ مالیات (%)" min="0" max="100" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition" oninput="updateTable()">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">تخفیف</label>
                        <div class="flex gap-4">
                            <input id="discount" type="number" placeholder="تخفیف" min="0" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition" oninput="updateTable()">
                            <select id="discountType" class="w-1/3 px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition" onchange="updateTable()">
                                <option value="numeric">عددی</option>
                                <option value="percentage">درصدی</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">نام مقدار دلخواه</label>
                        <input id="customName" type="text" placeholder="مثال: باربری" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition" oninput="updateTable()">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">مقدار دلخواه</label>
                        <input id="customAmount" type="number" placeholder="مقدار دلخواه" min="0" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition" oninput="updateTable()">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">نام پیش‌پرداخت</label>
                        <input id="prepaymentName" type="text" placeholder="مثال: پیش‌پرداخت" value="پیش‌پرداخت" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition" oninput="updateTable()">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">مقدار پیش‌پرداخت</label>
                        <div class="flex gap-4">
                            <input id="prepaymentAmount" type="number" placeholder="مقدار پیش‌پرداخت" min="0" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition" oninput="updateTable()">
                            <select id="prepaymentType" class="w-1/3 px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition" onchange="updateTable()">
                                <option value="subtract">تفریق</option>
                                <option value="add">جمع</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- لوگو و امضا -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-signature ml-2 text-blue-600"></i> لوگو و امضا
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">بارگذاری لوگو فاکتور</label>
                        <p class="text-sm text-gray-500 mb-2">(در صورت عدم انتخاب فروشنده)</p>
                        <input id="invoiceLogoInput" type="file" accept="image/*" class="w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">بارگذاری امضا فاکتور</label>
                        <p class="text-sm text-gray-500 mb-2">(در صورت عدم انتخاب فروشنده)</p>
                        <input id="invoiceSignatureInput" type="file" accept="image/*" class="w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div class="sm:col-span-2">
                        <label class="flex items-center">
                            <input id="includeSignature" type="checkbox" checked class="mr-2 w-5 h-5">
                            <span class="text-gray-700">درج امضا فروشنده در فاکتور</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- متن دلخواه -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-align-left ml-2 text-blue-600"></i> متن دلخواه
                </h2>
                <textarea id="customText" placeholder="متن دلخواه (مثال: شرایط پرداخت)" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition" rows="4"></textarea>
            </div>

            <!-- نمایش جمع‌بندی -->
            <div class="mb-8 summary-box">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-cash-register ml-2 text-blue-600"></i> جمع‌بندی
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="summary-item"><p><strong>مالیات:</strong> <span id="totalTax">۰</span></p></div>
                    <div class="summary-item"><p><strong>تخفیف:</strong> <span id="discountAmount">۰</span></p></div>
                    <div class="summary-item"><p><strong>مانده از قبل:</strong> <span id="debtAmount">۰</span></p></div>
                    <div id="customAmountContainer" class="summary-item"><p><strong>هزینه اضافی:</strong> <span id="customAmountDisplay">۰</span></p></div>
                    <div id="prepaymentAmountContainer" class="summary-item"><p><strong>پیش‌پرداخت:</strong> <span id="prepaymentAmountDisplay">۰</span></p></div>
                    <div class="col-span-1 sm:col-span-2 grand-total"><p class="text-lg sm:text-xl"><strong>مجموع کل:</strong> <span id="grandTotal">۰</span> | <span id="grandTotalText" class="font-medium"></span></p></div>
                </div>
            </div>

            <!-- دکمه‌های عملیات -->
<!-- در بخش دکمه‌های عملیات، دکمه چاپ را اضافه کنید -->
<div class="flex flex-wrap justify-end gap-4">
    <button onclick="generateInvoice()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:-translate-y-1 shadow-md">
        <i class="fas fa-file-invoice mr-2"></i> تولید فاکتور
    </button>
    <button onclick="generateImage()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:-translate-y-1 shadow-md">
        <i class="fas fa-download mr-2"></i> دانلود تصویر
    </button>
    <button onclick="printInvoice()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:-translate-y-1 shadow-md">
        <i class="fas fa-print mr-2"></i> چاپ فاکتور
    </button>
    <button onclick="saveInvoice()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:-translate-y-1 shadow-md">
        <i class="fas fa-save mr-2"></i> ذخیره فاکتور
    </button>
    <button onclick="loadInvoices()" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:-translate-y-1 shadow-md">
        <i class="fas fa-list mr-2"></i> نمایش فاکتورها
    </button>
    <button onclick="resetForm()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:-translate-y-1 shadow-md">
        <i class="fas fa-redo mr-2"></i> بازنشانی
    </button>
</div>

            <!-- پیش‌نمایش فاکتور -->
            <div id="invoicePreview" class="hidden mt-8 p-4 sm:p-8 bg-white rounded-lg shadow-lg">
                <div id="previewContent"></div>
            </div>

            <!-- فاکتورهای ذخیره‌شده -->
            <div id="savedInvoices" class="hidden mt-8 p-4 sm:p-8 bg-white rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-archive ml-2 text-blue-600"></i> فاکتورهای ذخیره‌شده
                </h2>
                <div id="savedInvoicesList" class="grid grid-cols-1 sm:grid-cols-2 gap-6"></div>
            </div>
        </div>

        <!-- تب جدید: مدیریت فاکتورها -->
        <div id="invoiceManagementTab" class="tab-content">
            <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-list-alt ml-2 text-blue-600"></i> مدیریت و نمایش فاکتورها
            </h2>
            
            <!-- آمار سریع -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-2xl font-bold text-blue-600" id="totalInvoicesCount">0</div>
                    <div class="text-gray-600">کل فاکتورها</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-2xl font-bold text-green-600" id="totalRevenue">0</div>
                    <div class="text-gray-600">کل درآمد</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-2xl font-bold text-purple-600" id="todayInvoicesCount">0</div>
                    <div class="text-gray-600">فاکتورهای امروز</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-2xl font-bold text-orange-600" id="todayRevenue">0</div>
                    <div class="text-gray-600">درآمد امروز</div>
                </div>
            </div>

            <!-- فیلترها -->
            <div class="bg-white p-4 rounded-lg shadow mb-6">
                <h3 class="font-semibold mb-4">فیلترهای جستجو</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2 text-sm">جستجوی متن</label>
                        <input id="invoiceSearchInput" type="text" placeholder="شماره، نوع، مشتری..." 
                               class="w-full px-3 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
                               oninput="searchInvoices()">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 text-sm">مشتری</label>
                        <select id="invoiceCustomerFilter" onchange="searchInvoices()"
                                class="w-full px-3 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                            <option value="">همه مشتریان</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 text-sm">تاریخ</label>
                        <input id="invoiceDateFilter" type="text" 
                               class="w-full px-3 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
                               onchange="searchInvoices()">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 text-sm">نوع فاکتور</label>
                        <select id="invoiceTypeFilter" onchange="searchInvoices()"
                                class="w-full px-3 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                            <option value="">همه انواع</option>
                            <option value="صورتحساب فروش">فروش</option>
                            <option value="صورتحساب خرید">خرید</option>
                            <option value="پیش‌فاکتور">پیش‌فاکتور</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- لیست فاکتورها -->
            <div id="invoiceManagementList" class="grid grid-cols-1 gap-4">
                <!-- فاکتورها در اینجا نمایش داده می‌شوند -->
            </div>
        </div>

        <!-- تب جدید: گزارش‌ها و آمار -->
        <div id="reportsTab" class="tab-content">
            <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-chart-bar ml-2 text-blue-600"></i> گزارش‌ها و آمار
            </h2>

            <!-- فیلتر تاریخ -->
            <div class="bg-white p-4 rounded-lg shadow mb-6">
                <h3 class="font-semibold mb-4">فیلتر بازه زمانی</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">از تاریخ</label>
                        <input id="reportStartDate" type="text" 
                               class="w-full px-3 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">تا تاریخ</label>
                        <input id="reportEndDate" type="text" 
                               class="w-full px-3 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div class="flex items-end">
                        <button onclick="filterReports()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition">
                            اعمال فیلتر
                        </button>
                    </div>
                </div>
            </div>

            <!-- خلاصه مالی -->
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-xl font-bold text-blue-600" id="reportTotalSales">0</div>
                    <div class="text-gray-600">کل فروش</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-xl font-bold text-green-600" id="reportTotalTax">0</div>
                    <div class="text-gray-600">مالیات</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-xl font-bold text-red-600" id="reportTotalDiscount">0</div>
                    <div class="text-gray-600">تخفیف</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-xl font-bold text-purple-600" id="reportInvoiceCount">0</div>
                    <div class="text-gray-600">تعداد فاکتور</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-xl font-bold text-orange-600" id="reportAverageSale">0</div>
                    <div class="text-gray-600">میانگین فروش</div>
                </div>
            </div>

            <!-- نمودار فروش -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-semibold">گزارش فروش روزانه</h3>
                    <button onclick="printReport('salesReport')" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">
                        چاپ گزارش
                    </button>
                </div>
                <div id="salesReport">
                    <canvas id="salesChart" height="100"></canvas>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- مشتریان برتر -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-semibold">مشتریان برتر</h3>
                        <button onclick="printReport('topCustomers')" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">
                            چاپ گزارش
                        </button>
                    </div>
                    <div id="topCustomers">
                        <div id="topCustomersList">
                            <!-- لیست مشتریان برتر -->
                        </div>
                    </div>
                </div>

                <!-- محصولات پرفروش -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-semibold">محصولات پرفروش</h3>
                        <button onclick="printReport('topProducts')" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">
                            چاپ گزارش
                        </button>
                    </div>
                    <div id="topProducts">
                        <div id="topProductsList">
                            <!-- لیست محصولات پرفروش -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- تب جدید: مدیریت کاربران -->
        <div id="userManagementTab" class="tab-content">
            <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-users-cog ml-2 text-blue-600"></i> مدیریت کاربران سیستم
            </h2>

            <!-- فرم افزودن کاربر -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="font-semibold mb-4">افزودن کاربر جدید</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 mb-2">نام کامل</label>
                        <input id="newUserName" type="text" class="w-full px-3 py-2 rounded-lg border">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">نام کاربری</label>
                        <input id="newUserUsername" type="text" class="w-full px-3 py-2 rounded-lg border">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">رمز عبور</label>
                        <input id="newUserPassword" type="password" class="w-full px-3 py-2 rounded-lg border">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">نقش</label>
                        <select id="newUserRole" class="w-full px-3 py-2 rounded-lg border">
                            <option value="user">کاربر عادی</option>
                            <option value="admin">مدیر سیستم</option>
                        </select>
                    </div>
                </div>
                <button onclick="addUser()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">
                    افزودن کاربر
                </button>
            </div>

            <!-- لیست کاربران -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="font-semibold mb-4">لیست کاربران سیستم</h3>
                <div id="userList" class="space-y-4">
                    <!-- کاربران در اینجا نمایش داده می‌شوند -->
                </div>
            </div>
        </div>

        <!-- تب مدیریت حسابداری -->
        <div id="accountingTab" class="tab-content">
            <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-chart-line ml-2 text-blue-600"></i> مدیریت حسابداری مشتریان
            </h2>
            
            <!-- انتخاب مشتری -->
            <div class="mb-6">
                <label class="block text-gray-700 mb-2 font-medium">انتخاب مشتری</label>
                <select id="accountingCustomerSelect" onchange="loadCustomerAccounting()" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    <option value="">انتخاب مشتری</option>
                </select>
            </div>

            <!-- اطلاعات مالی مشتری -->
            <div class="summary-box mb-6">
                <h3 class="text-lg font-semibold mb-4">خلاصه وضعیت مالی</h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div class="summary-item">
                        <p><strong>کل خریدها:</strong> <span id="totalPurchases">0</span> ریال</p>
                    </div>
                    <div class="summary-item">
                        <p><strong>پرداخت‌ها:</strong> <span id="totalPayments">0</span> ریال</p>
                    </div>
                    <div class="summary-item">
                        <p><strong>مانده حساب:</strong> <span id="accountBalance">0</span> ریال</p>
                    </div>
                </div>
            </div>

            <!-- فرم ثبت پرداخت -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">ثبت پرداخت جدید</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">مبلغ پرداختی (ریال)</label>
                        <input id="paymentAmount" type="number" placeholder="مبلغ به ریال" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">تاریخ پرداخت</label>
                        <input id="paymentDate" type="text" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div class="sm:col-span-2">
                        <label class="block text-gray-700 mb-2 font-medium">توضیحات پرداخت</label>
                        <textarea id="paymentDescription" placeholder="شرح پرداخت" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 transition" rows="3"></textarea>
                    </div>
                    <div class="sm:col-span-2">
                        <button onclick="addPayment()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:-translate-y-1 shadow-md">
                            ثبت پرداخت
                        </button>
                    </div>
                </div>
            </div>

            <!-- تاریخچه تراکنش‌ها -->
            <div>
                <h3 class="text-lg font-semibold text-gray-800 mb-4">تاریخچه تراکنش‌ها</h3>
                <div id="transactionHistory" class="space-y-4">
                    <!-- تراکنش‌ها در اینجا نمایش داده می‌شوند -->
                </div>
            </div>
        </div>

    </div>

    <!-- پیش‌نمایش فاکتور در مدیریت -->
    <div id="invoiceManagementPreview" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-auto">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="font-semibold">پیش‌نمایش فاکتور</h3>
                <button onclick="closeInvoicePreview()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="invoiceManagementPreviewContent" class="p-4">
                <!-- محتوای پیش‌نمایش -->
            </div>
        </div>
    </div>

    <!-- Modal بازیابی رمز عبور -->
    <div id="passwordRecoveryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg w-full max-w-md">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="font-semibold">بازیابی رمز عبور</h3>
                <button onclick="closePasswordRecovery()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">نام کاربری</label>
                    <input id="recoveryUsername" type="text" class="w-full px-3 py-2 rounded-lg border" placeholder="نام کاربری خود را وارد کنید">
                </div>
                <div class="flex justify-end gap-2">
                    <button onclick="closePasswordRecovery()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        انصراف
                    </button>
                    <button onclick="recoverPassword()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                        بازیابی رمز عبور
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal پروفایل کاربر -->
    <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <!-- محتوای پروفایل توسط JavaScript پر می‌شود -->
    </div>

    <script src="./utils.js"></script>
    <script src="./multiUser.js"></script>
    <script src="./auth.js"></script>
    <script src="./tabs.js"></script>
    <script src="./data.js"></script>
    <script src="./invoice.js"></script>
    <script src="./invoiceManagement.js"></script>
    <script src="./reports.js"></script>
    <script src="./dataManager.js"></script>
    <script src="./indexedDB.js"></script>
    
    <script>
        // راه‌اندازی اولیه سیستم
        document.addEventListener('DOMContentLoaded', function() {
            console.log('System initializing...');
            
            // بازنشانی کاربران پیش‌فرض برای اطمینان
            resetDefaultUsers();
            
            // بررسی وضعیت ورود
            setTimeout(function() {
                if (typeof checkLoginStatus === 'function') {
                    checkLoginStatus();
                }
            }, 100);
            
            // نمایش تب مدیریت کاربران فقط برای مدیران
            setTimeout(checkUserRole, 500);
            
            // تنظیم تاریخ‌های پیش‌فرض
            setDefaultDates();
        });

        // تابع برای بازنشانی کاربران پیش‌فرض
        function resetDefaultUsers() {
            console.log('Resetting default users...');
            const defaultUsers = [
                {
                    id: 1,
                    username: 'admin',
                    password: 'admin',
                    role: 'admin',
                    name: 'مدیر سیستم',
                    email: 'admin@system.com',
                    phone: '09123456789',
                    createdAt: new Date().toLocaleString('fa-IR'),
                    lastLogin: null,
                    isActive: true
                },
                {
                    id: 2,
                    username: 'user',
                    password: 'user',
                    role: 'user',
                    name: 'کاربر عادی',
                    email: 'user@system.com',
                    phone: '09123456780',
                    createdAt: new Date().toLocaleString('fa-IR'),
                    lastLogin: null,
                    isActive: true
                }
            ];
            
            localStorage.setItem('users', JSON.stringify(defaultUsers));
            console.log('Default users reset successfully');
        }

        // نمایش modal بازیابی رمز عبور
        function showPasswordRecovery() {
            document.getElementById('passwordRecoveryModal').classList.remove('hidden');
        }

        // بستن modal بازیابی رمز عبور
        function closePasswordRecovery() {
            document.getElementById('passwordRecoveryModal').classList.add('hidden');
            document.getElementById('recoveryUsername').value = '';
        }
        
        // تنظیم تاریخ‌های پیش‌فرض
        function setDefaultDates() {
            const today = new Date().toLocaleDateString('fa-IR');
            const dateFields = ['invoiceDate', 'paymentDate', 'reportStartDate', 'reportEndDate', 'invoiceDateFilter'];
            
            dateFields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element && !element.value) {
                    element.value = today;
                }
            });
        }
    </script>
</body>
</html>